<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Ticaret Finansal Sim√ºlat√∂r√º - Kƒ±yaslama</title>
    <style>
        /* Genel Stil ve Temel Ayarlar */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #eef3f6;
            color: #333;
        }
        .container {
            max-width: 1400px;
            height: 100vh;
            margin: auto;
            display: grid;
            grid-template-columns: 350px 1fr; /* Sol Sidebar: 350px, Saƒü Kƒ±yaslama: Geni≈ü */
            gap: 15px;
            padding: 15px;
            box-sizing: border-box;
            overflow: hidden; /* Ana scroll engellendi */
        }
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: hidden; /* Scroll tamamen kaldƒ±rƒ±ldƒ± */
            padding-right: 5px;
        }
        .right-column {
            display: grid;
            grid-template-rows: 1fr; /* Tek bir geni≈ü kƒ±yaslama alanƒ± */
            gap: 15px;
            overflow-y: auto; /* Saƒü tarafta gerektiƒüinde scroll a√ßƒ±labilir */
            padding-right: 5px;
        }

        /* Kart ve Input Stilleri */
        .card {
            background-color: #fff;
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }
        .tab-controls { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 10px; }
        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-weight: 600;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
        }
        .tab-button.active { background-color: #007bff; color: white; border-bottom: 2px solid #007bff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        h2 { color: #007bff; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px; margin-top: 0; font-size: 1.3em; font-weight: 600; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .input-group label { display: block; font-size: 0.85em; margin-top: 10px; margin-bottom: 3px; font-weight: 500; color: #555; }
        .input-group input { padding: 8px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 0.9em; }

        /* Kƒ±yaslama Tablosu Stilleri */
        .comparison-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        .comparison-table th, .comparison-table td { padding: 10px; border: 1px solid #ddd; text-align: right; }
        .comparison-table th:first-child { text-align: left; background-color: #f8f9fa; width: 35%; }
        .comparison-table thead th { background-color: #007bff; color: white; text-align: center; }
        .comparison-table tbody tr:nth-child(even) { background-color: #fcfcfc; }
        .comparison-table tfoot th, .comparison-table tfoot td { font-weight: bold; background-color: #d1e7dd; }
        .diff-pos { color: #28a745; font-weight: bold; }
        .diff-neg { color: #dc3545; font-weight: bold; }
        .diff-zero { color: #6c757d; }
    </style>
</head>
<body>

<div class="container">
    <div class="left-column">
        <div class="card" style="padding: 0;">
            <div class="tab-controls">
                <button class="tab-button active" id="tab-btn-1" onclick="openScenario(event, 'scenario1')">Senaryo 1 (Mevcut)</button>
                <button class="tab-button" id="tab-btn-2" onclick="openScenario(event, 'scenario2')">Senaryo 2 (Kƒ±yaslama)</button>
            </div>
            
            <div id="scenario1" class="tab-content active" style="padding: 18px;">
                <p style="font-size: 0.8em; color: #6c757d;">Mevcut i≈ü modelinizin parametrelerini girin.</p>
                <div id="inputs-container-1"></div>
            </div>

            <div id="scenario2" class="tab-content" style="padding: 18px;">
                <p style="font-size: 0.8em; color: #6c757d;">Kƒ±yaslamak istediƒüiniz yeni satƒ±≈ü/maliyet varsayƒ±mlarƒ±nƒ± girin.</p>
                <div id="inputs-container-2"></div>
            </div>
        </div>
        <div class="card">
            <h2>üéØ Hedefler</h2>
             <p style="font-size: 0.8em; color: #6c757d;">Hedefleriniz, iki senaryonun da Birim Fiyat ve Gerekli Adet analizini tetikler.</p>
            <div class="input-group">
                <label for="hedefKarTL-1">Hedef Net K√¢r (‚Ç∫)</label>
                <input type="number" id="hedefKarTL-1" value="50000" oninput="saveAndCalculate(event, 'hedefKarTL', '1'); saveAndCalculate(event, 'hedefKarTL', '2');">
            </div>
        </div>
    </div>

    <div class="right-column">
        <div class="card">
            <h2>üìä Senaryo Kƒ±yaslama ve Kar≈üƒ±la≈ütƒ±rma</h2>
            <p style="font-size: 0.8em; color: #6c757d;">Fark: Senaryo 2 - Senaryo 1</p>

            <h3 style="margin-top: 15px; color: #343a40;">üìà Aylƒ±k K√¢r/Zarar Metrikleri</h3>
            <table class="comparison-table" id="comparison-main-table">
                <thead>
                    <tr>
                        <th style="width: 35%;">Metrikler</th>
                        <th>Senaryo 1</th>
                        <th>Senaryo 2</th>
                        <th>Fark (S2 - S1)</th>
                    </tr>
                </thead>
                <tbody id="comparison-body">
                    </tbody>
                <tfoot>
                    <tr class="final-row">
                        <th>NET K√ÇR / ZARAR</th>
                        <td id="comp-netKar1"></td>
                        <td id="comp-netKar2"></td>
                        <td id="comp-netKarDiff"></td>
                    </tr>
                </tfoot>
            </table>

            <h3 style="margin-top: 25px; color: #343a40;">üìâ Birim Ekonomisi ve Verimlilik Kƒ±yaslamasƒ±</h3>
            <table class="comparison-table" id="comparison-unit-table">
                <thead>
                    <tr>
                        <th style="width: 35%;">Birim Metrikler</th>
                        <th>Senaryo 1</th>
                        <th>Senaryo 2</th>
                        <th>Fark (S2 - S1)</th>
                    </tr>
                </thead>
                <tbody id="comparison-unit-body">
                     </tbody>
            </table>

            <h3 style="margin-top: 25px; color: #343a40;">‚öñÔ∏è Vergi ve Verimlilik Y√ºzdeleri</h3>
            <table class="comparison-table" id="comparison-percent-table">
                <thead>
                    <tr>
                        <th style="width: 35%;">Y√ºzdesel Metrikler</th>
                        <th>Senaryo 1</th>
                        <th>Senaryo 2</th>
                        <th>Fark (S2 - S1)</th>
                    </tr>
                </thead>
                <tbody id="comparison-percent-body">
                     </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Zorunlu Sabitler
    const PLATFORM_FEE_KDV_INCL = 10.19;
    const GIDER_KDV_ORANI_SABIT = 20; 
    const STOPAJ_RATE = 0.01; 

    // Varsayƒ±lan deƒüerler, eƒüer localStorage bo≈üsa kullanƒ±lƒ±r.
    const DEFAULT_INPUTS = {
        adet: 500, satisFiyat: 999.99, birimMaliyet: 312.98, kargo: 85.44, komisyon: 21, kdvOrani: 20, iadeOrani: 8, gelirVergisi: 25,
        personel: 17082, depo: 5000, muhasebe: 4800, pazarlama: 10000, digerGiderler: 2000, hedefKarTL: 50000
    };

    // --- G√úVENLƒ∞K VE FORMATLAMA FONKSƒ∞YONLARI ---
    const getNum = (id, scenario) => {
        const inputId = `${id}-${scenario}`;
        const storedValue = localStorage.getItem(inputId);
        const defaultValue = DEFAULT_INPUTS[id] !== undefined ? DEFAULT_INPUTS[id] : 0;
        const value = storedValue !== null ? storedValue : defaultValue;
        const num = parseFloat(String(value).replace(',', '.')) || 0;
        return num;
    };
    
    // INPUT'A YAZILIRKEN LOCALSTORAGE'A KAYDETME
    const saveAndCalculate = (event, id, scenario) => {
        const value = event.target.value;
        const inputId = `${id}-${scenario}`;
        localStorage.setItem(inputId, value);
        calculate();
    };

    const formatTL = (number) => {
        const formatted = Math.abs(number).toFixed(2).replace('.', ',');
        if (number < 0) {
            return `<span class="negative-value">(‚Ç∫${formatted})</span>`;
        } else {
            return `<span class="positive-value">‚Ç∫${formatted}</span>`;
        }
    };
    
    const formatPercent = (number) => {
        if (isNaN(number) || !isFinite(number)) return '0.00%';
        return (number * 100).toFixed(2).replace('.', ',') + '%';
    };

    const formatDiff = (diff) => {
        const formatted = Math.abs(diff).toFixed(2).replace('.', ',');
        if (diff > 0) {
            return `<span class="diff-pos">‚Üë ‚Ç∫${formatted}</span>`;
        } else if (diff < 0) {
            return `<span class="diff-neg">‚Üì (‚Ç∫${formatted})</span>`;
        } else {
            return `<span class="diff-zero">‚Ç∫0,00</span>`;
        }
    };

    const formatPercentDiff = (diff) => {
        const formatted = Math.abs(diff * 100).toFixed(2).replace('.', ',');
        if (diff > 0) {
            return `<span class="diff-pos">‚Üë ${formatted}%</span>`;
        } else if (diff < 0) {
            return `<span class="diff-neg">‚Üì (${formatted}%)</span>`;
        } else {
            return `<span class="diff-zero">0.00%</span>`;
        }
    };

    const solveVAT = (amountKDVIncl, vatRate) => {
        const rateDecimal = vatRate / 100;
        if (vatRate === 0 || amountKDVIncl === 0) {
            return { net: amountKDVIncl, vat: 0 };
        }
        const net = amountKDVIncl / (1 + rateDecimal);
        const vat = amountKDVIncl - net;
        return { net, vat };
    };
    
    const formatKDVIncl = (netAmount, vatRate) => {
        const rateDecimal = vatRate / 100;
        const total = netAmount * (1 + rateDecimal);
        return total; 
    };

    // --- HTML INPUT OLU≈ûTURUCU ---
    const createInputs = (scenario) => {
        const allKeys = Object.keys(DEFAULT_INPUTS).filter(key => key !== 'hedefKarTL'); // Hedef K√¢r TL sadece 1. senaryoda g√∂r√ºn√ºr
        
        // LocalStorage'dan veya Default'tan deƒüer √ßekme fonksiyonu
        const getValue = (key) => {
            const storedValue = localStorage.getItem(`${key}-${scenario}`);
            if (storedValue !== null) {
                return storedValue;
            }
            return DEFAULT_INPUTS[key];
        };

        let inputsHtml = `
            <div class="card" style="box-shadow: none; padding: 0;">
                <div class="grid-2">
                    <div class="input-group">
                        <label for="adet-${scenario}">Tahmini Satƒ±≈ü Adedi</label>
                        <input type="number" id="adet-${scenario}" value="${getValue('adet')}" oninput="saveAndCalculate(event, 'adet', '${scenario}')">
                    </div>
                    <div class="input-group">
                        <label for="satisFiyat-${scenario}">Birim Satƒ±≈ü Fiyatƒ± (KDV Dahil, ‚Ç∫)</label>
                        <input type="number" id="satisFiyat-${scenario}" value="${getValue('satisFiyat')}" oninput="saveAndCalculate(event, 'satisFiyat', '${scenario}')">
                    </div>
                </div>
                <div class="grid-2">
                    <div class="input-group">
                        <label for="birimMaliyet-${scenario}">Birim Maliyet (KDV Dahil, ‚Ç∫)</label>
                        <input type="number" id="birimMaliyet-${scenario}" value="${getValue('birimMaliyet')}" oninput="saveAndCalculate(event, 'birimMaliyet', '${scenario}')">
                    </div>
                    <div class="input-group">
                        <label for="kargo-${scenario}">Ort. Kargo Gideri (KDV Dahil, ‚Ç∫)</label>
                        <input type="number" id="kargo-${scenario}" value="${getValue('kargo')}" oninput="saveAndCalculate(event, 'kargo', '${scenario}')">
                    </div>
                </div>
                <div class="grid-3">
                    <div class="input-group">
                        <label for="komisyon-${scenario}">Komisyon Y√ºzdesi (%)</label>
                        <input type="number" id="komisyon-${scenario}" value="${getValue('komisyon')}" oninput="saveAndCalculate(event, 'komisyon', '${scenario}')">
                    </div>
                    <div class="input-group">
                        <label for="kdvOrani-${scenario}">Satƒ±≈ü/Alƒ±≈ü KDV Oranƒ± (%)</label>
                        <input type="number" id="kdvOrani-${scenario}" value="${getValue('kdvOrani')}" oninput="saveAndCalculate(event, 'kdvOrani', '${scenario}')">
                    </div>
                    <div class="input-group">
                        <label for="iadeOrani-${scenario}">ƒ∞ade Oranƒ± (%)</label>
                        <input type="number" id="iadeOrani-${scenario}" value="${getValue('iadeOrani')}" oninput="saveAndCalculate(event, 'iadeOrani', '${scenario}')">
                    </div>
                </div>
                <div class="input-group">
                    <label for="gelirVergisi-${scenario}">Gelir/Kurumlar Vergisi Oranƒ± (%)</label>
                    <input type="number" id="gelirVergisi-${scenario}" value="${getValue('gelirVergisi')}" oninput="saveAndCalculate(event, 'gelirVergisi', '${scenario}')">
                </div>
            </div>
            
            <div class="card" style="box-shadow: none; padding: 0;">
                <h2>Sabit Giderler (Aylƒ±k - KDV Dahil)</h2>
                <div class="grid-2">
                    <div class="input-group">
                        <label for="personel-${scenario}">Personel (‚Ç∫)</label>
                        <input type="number" id="personel-${scenario}" value="${getValue('personel')}" oninput="saveAndCalculate(event, 'personel', '${scenario}')">
                    </div>
                    <div class="input-group">
                        <label for="depo-${scenario}">Depo / Kira (‚Ç∫)</label>
                        <input type="number" id="depo-${scenario}" value="${getValue('depo')}" oninput="saveAndCalculate(event, 'depo', '${scenario}')">
                    </div>
                </div>
                <div class="grid-2">
                    <div class="input-group">
                        <label for="muhasebe-${scenario}">Muhasebe / Yazƒ±lƒ±m (‚Ç∫)</label>
                        <input type="number" id="muhasebe-${scenario}" value="${getValue('muhasebe')}" oninput="saveAndCalculate(event, 'muhasebe', '${scenario}')">
                    </div>
                    <div class="input-group">
                        <label for="pazarlama-${scenario}">Pazarlama / Reklam (‚Ç∫)</label>
                        <input type="number" id="pazarlama-${scenario}" value="${getValue('pazarlama')}" oninput="saveAndCalculate(event, 'pazarlama', '${scenario}')">
                    </div>
                </div>
                <div class="input-group">
                    <label for="digerGiderler-${scenario}">Diƒüer Giderler (‚Ç∫)</label>
                    <input type="number" id="digerGiderler-${scenario}" value="${getValue('digerGiderler')}" oninput="saveAndCalculate(event, 'digerGiderler', '${scenario}')">
                </div>
            </div>
        `;
        document.getElementById(`inputs-container-${scenario}`).innerHTML = inputsHtml;
    };


    // --- Finansal Hesaplama Motoru ---
    const runAnalysis = (scenario) => {
        const adet = getNum('adet', scenario);
        if (adet === 0) return null; 

        const satisFiyatKDV = getNum('satisFiyat', scenario);
        const birimMaliyetKDV = getNum('birimMaliyet', scenario);
        const kargoKDV = getNum('kargo', scenario);
        const komisyonYuzde = getNum('komisyon', scenario) / 100;
        const genelKdvOrani = getNum('kdvOrani', scenario); 
        const iadeOrani = getNum('iadeOrani', scenario) / 100;
        const gelirVergisiYuzde = getNum('gelirVergisi', scenario) / 100;
        
        // Hedef K√¢r TL'yi sadece S1'den √ßekelim ve S2'de de kullanalƒ±m
        const hedefKarTL = getNum('hedefKarTL', '1'); 

        const personelKDV = getNum('personel', scenario);
        const depoKDV = getNum('depo', scenario);
        const muhasebeKDV = getNum('muhasebe', scenario);
        const pazarlamaKDV = getNum('pazarlama', scenario);
        const digerGiderlerKDV = getNum('digerGiderler', scenario);

        // --- 2. KDV √á√∂z√ºmleme ---
        const satis = solveVAT(satisFiyatKDV, genelKdvOrani);
        const maliyet = solveVAT(birimMaliyetKDV, genelKdvOrani);
        const kargo = solveVAT(kargoKDV, GIDER_KDV_ORANI_SABIT);
        const platformFee = solveVAT(PLATFORM_FEE_KDV_INCL, GIDER_KDV_ORANI_SABIT);
        
        const personelNet = personelKDV; 
        const depo = solveVAT(depoKDV, GIDER_KDV_ORANI_SABIT);
        const muhasebe = solveVAT(muhasebeKDV, GIDER_KDV_ORANI_SABIT);
        const pazarlama = solveVAT(pazarlamaKDV, GIDER_KDV_ORANI_SABIT);
        const digerGiderler = solveVAT(digerGiderlerKDV, GIDER_KDV_ORANI_SABIT);

        // --- 3. Gelir, Br√ºt K√¢r (KDV Hari√ß) ---
        const brutSatisHasilatiKDVHari√ß = satis.net * adet;
        const iadeKaybiAdet = adet * iadeOrani;
        const iadeTutariNet = iadeKaybiAdet * satis.net;
        const netSatisHasilati = brutSatisHasilatiKDVHari√ß - iadeTutariNet; 
        const smToplam = maliyet.net * adet;
        const brutKar = netSatisHasilati - smToplam; 

        // --- 4. Faaliyet Giderleri (KDV Hari√ß) ---
        const komisyonToplam = netSatisHasilati * komisyonYuzde;
        const kargoToplam = kargo.net * adet;
        const platformFeeToplam = platformFee.net * adet;
        const stopajBirim = satis.net * STOPAJ_RATE;
        const stopajToplam = stopajBirim * adet;

        const sabitGiderlerToplamNet = personelNet + depo.net + muhasebe.net + pazarlama.net + digerGiderler.net;
        
        const faaliyetGiderleriToplam = komisyonToplam + kargoToplam + platformFeeToplam + stopajToplam + sabitGiderlerToplamNet;

        // --- 5. K√¢r ---
        const faaliyetKar = brutKar - faaliyetGiderleriToplam; 
        const vergi = faaliyetKar > 0 ? faaliyetKar * gelirVergisiYuzde : 0;
        const netKar = faaliyetKar - vergi; 

        // --- 6. √ñdenecek KDV Hesaplamasƒ± ---
        const satisKDVTutari = satis.vat * (adet - iadeKaybiAdet);
        const alisKDV = maliyet.vat * adet; 
        const kargoKDVTutari = kargo.vat * adet;
        const platformFeeKDV = platformFee.vat * adet;
        const komisyonKDV = komisyonToplam * (GIDER_KDV_ORANI_SABIT / 100); 
        const sabitGiderlerKDVToplam = depo.vat + muhasebe.vat + pazarlama.vat + digerGiderler.vat;

        const indirilebilirKDVToplam = alisKDV + komisyonKDV + kargoKDVTutari + platformFeeKDV + sabitGiderlerKDVToplam;
        const odenecekKDVBrut = satisKDVTutari - indirilebilirKDVToplam;
        const odenecekKDV = odenecekKDVBrut > 0 ? odenecekKDVBrut : 0;
        const devredenKDV = odenecekKDVBrut < 0 ? Math.abs(odenecekKDVBrut) : 0;
        
        // --- 7. Birim Ekonomisi ve Hedef Fiyat ---
        const birimToplamMaliyet = faaliyetGiderleriToplam / adet + smToplam / adet;
        const birimKomisyon = komisyonToplam / adet;
        const birimDeƒüi≈ükenMaliyetlerTop = maliyet.net + birimKomisyon + kargo.net + platformFee.net + stopajBirim;
        const katkiPayiBirim = satis.net - birimDeƒüi≈ükenMaliyetlerTop;
        const bepAdet = katkiPayiBirim > 0 ? sabitGiderlerToplamNet / katkiPayiBirim : 0;
        const hedefAdet = katkiPayiBirim > 0 ? (sabitGiderlerToplamNet + hedefKarTL) / katkiPayiBirim : 0;

        // Hedef Fiyat Hesaplama
        const hedefKarNet = hedefKarTL / (1 - gelirVergisiYuzde); 
        const birimHedefKarNet = hedefKarNet / adet;
        const birimSabitGider = sabitGiderlerToplamNet / adet;
        const birimDeƒüi≈ükenMaliyetlerHari√ßKomisyon = maliyet.net + kargo.net + platformFee.net + stopajBirim;
        
        const pay = birimDeƒüi≈ükenMaliyetlerHari√ßKomisyon + birimSabitGider + birimHedefKarNet;
        const payda = (1 - komisyonYuzde) * (1 - iadeOrani);
        
        let hedefBirimSatisNet = 0;
        if (payda > 0) {
             hedefBirimSatisNet = pay / payda;
        }
        const hedefFiyatKDVIncl = formatKDVIncl(hedefBirimSatisNet, genelKdvOrani);

        // Y√ºzdeler
        const marginBrut = netSatisHasilati !== 0 ? brutKar / netSatisHasilati : 0;
        const marginFaaliyet = netSatisHasilati !== 0 ? faaliyetKar / netSatisHasilati : 0;
        const marginNet = netSatisHasilati !== 0 ? netKar / netSatisHasilati : 0;
        const marginIade = brutSatisHasilatiKDVHari√ß !== 0 ? iadeTutariNet / brutSatisHasilatiKDVHari√ß : 0;


        return {
            netKar: netKar, faaliyetKar: faaliyetKar, brutKar: brutKar, netSatisHasilati: netSatisHasilati, 
            iadeTutariNet: iadeTutariNet, smToplam: smToplam, faaliyetGiderleriToplam: faaliyetGiderleriToplam,
            odenecekKDV: odenecekKDV, alisKDV: alisKDV, sabitGiderlerKDVToplam: sabitGiderlerKDVToplam, devredenKDV: devredenKDV,
            netKarBirim: netKar / adet, katkiPayiBirim: katkiPayiBirim, bepAdet: bepAdet, hedefAdet: hedefAdet,
            hedefFiyatKDVIncl: hedefFiyatKDVIncl, marginBrut: marginBrut, marginFaaliyet: marginFaaliyet,
            marginNet: marginNet, marginIade: marginIade
        };
    };

    // --- Kƒ±yaslama ve Raporlama ---
    const calculate = () => {
        const result1 = runAnalysis('1');
        const result2 = runAnalysis('2');
        
        if (!result1 && !result2) {
             document.getElementById('comparison-main-table').style.display = 'none';
             return;
        }
        document.getElementById('comparison-main-table').style.display = 'table';
        document.getElementById('comparison-unit-table').style.display = 'table';
        document.getElementById('comparison-percent-table').style.display = 'table';


        const formatValue = (result, key, isInt = false) => {
            if (!result) return '‚Äî';
            const value = result[key];
            if (isInt) return `${Math.ceil(value)} Adet`;
            if (key === 'hedefFiyatKDVIncl') return `‚Ç∫${value.toFixed(2).replace('.', ',')}`; // KDV dahil fiyat
            return formatTL(value);
        };
        
        const metrics = [
            { label: 'Br√ºt Satƒ±≈ü Hasƒ±latƒ±', key: 'netSatisHasilati' },
            { label: '(-) ƒ∞ade Tutarƒ±', key: 'iadeTutariNet' },
            { label: 'Net Satƒ±≈ü Hasƒ±latƒ±', key: 'netSatisHasilati', type: 'subtotal' },
            { label: '(-) Satƒ±≈ü Maliyeti (SM)', key: 'smToplam' },
            { label: 'Br√ºt K√¢r', key: 'brutKar' },
            { label: 'Toplam Faaliyet Giderleri', key: 'faaliyetGiderleriToplam' },
            { label: 'Faaliyet K√¢rƒ± (EBIT)', key: 'faaliyetKar' },
            { label: '√ñdenecek KDV', key: 'odenecekKDV' },
            { label: 'Biriken (Devreden) KDV', key: 'devredenKDV' },
        ];

        let tbodyHtml = '';
        metrics.forEach(metric => {
            const val1 = result1 ? result1[metric.key] : 0;
            const val2 = result2 ? result2[metric.key] : 0;
            const diff = val2 - val1;
            const rowClass = metric.type === 'subtotal' ? 'subtotal-row' : '';
            tbodyHtml += `
                <tr class="${rowClass}">
                    <th>${metric.label}</th>
                    <td>${formatValue(result1, metric.key)}</td>
                    <td>${formatValue(result2, metric.key)}</td>
                    <td>${formatDiff(diff)}</td>
                </tr>
            `;
        });
        
        const unitMetrics = [
            { label: 'Net K√¢r / Birim', key: 'netKarBirim' },
            { label: 'Birim Katkƒ± Payƒ±', key: 'katkiPayiBirim' },
            { label: 'Ba≈üaba≈ü Noktasƒ±', key: 'bepAdet', isInt: true },
            { label: 'Hedef K√¢r ƒ∞√ßin Gerekli Adet', key: 'hedefAdet', isInt: true },
            { label: 'Hedef K√¢r ƒ∞√ßin Birim Fiyat (KDV Dahil)', key: 'hedefFiyatKDVIncl' },
        ];
        
        let unitBodyHtml = '';
        unitMetrics.forEach(metric => {
            const val1 = result1 ? result1[metric.key] : 0;
            const val2 = result2 ? result2[metric.key] : 0;
            const diff = val2 - val1;
            
            unitBodyHtml += `
                <tr>
                    <th>${metric.label}</th>
                    <td>${formatValue(result1, metric.key, metric.isInt)}</td>
                    <td>${formatValue(result2, metric.key, metric.isInt)}</td>
                    <td>${metric.isInt ? formatDiff(diff) : formatDiff(diff)}</td>
                </tr>
            `;
        });
        
        const percentMetrics = [
            { label: 'K√¢r Marjƒ± (Net)', key: 'marginNet' },
            { label: 'K√¢r Marjƒ± (Br√ºt)', key: 'marginBrut' },
            { label: 'K√¢r Marjƒ± (Faaliyet)', key: 'marginFaaliyet' },
            { label: 'ƒ∞ade Oranƒ± (Tutar)', key: 'marginIade' },
            { label: 'Alƒ±≈ü KDV (ƒ∞ndirilebilir)', key: 'alisKDV' },
        ];
        
        let percentBodyHtml = '';
        percentMetrics.forEach(metric => {
            const val1 = result1 ? result1[metric.key] : 0;
            const val2 = result2 ? result2[metric.key] : 0;
            const diff = val2 - val1;

            const displayFormat = (metric.key === 'alisKDV') ? formatTL : formatPercent;
            const diffFormat = (metric.key === 'alisKDV') ? formatDiff : formatPercentDiff;

            percentBodyHtml += `
                <tr>
                    <th>${metric.label}</th>
                    <td>${displayFormat(result1, metric.key)}</td>
                    <td>${displayFormat(result2, metric.key)}</td>
                    <td>${diffFormat(diff)}</td>
                </tr>
            `;
        });


        document.getElementById('comparison-body').innerHTML = tbodyHtml;
        document.getElementById('comparison-unit-body').innerHTML = unitBodyHtml;
        document.getElementById('comparison-percent-body').innerHTML = percentBodyHtml;

        // Footer G√ºncelleme
        const netKar1 = result1 ? result1.netKar : 0;
        const netKar2 = result2 ? result2.netKar : 0;
        const netKarDiff = netKar2 - netKar1;
        document.getElementById('comp-netKar1').innerHTML = formatTL(netKar1);
        document.getElementById('comp-netKar2').innerHTML = formatTL(netKar2);
        document.getElementById('comp-netKarDiff').innerHTML = formatDiff(netKarDiff);
    };

    // --- Sekme Kontrol√º ---
    const openScenario = (evt, scenarioName) => {
        const tabcontent = document.getElementsByClassName("tab-content");
        for (let i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            tabcontent[i].classList.remove("active");
        }

        const tablinks = document.getElementsByClassName("tab-button");
        for (let i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }

        document.getElementById(scenarioName).style.display = "block";
        document.getElementById(scenarioName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }


    // Sayfa Y√ºklendiƒüinde
    document.addEventListener('DOMContentLoaded', () => {
        createInputs('1');
        createInputs('2');
        
        // Varsayƒ±lan olarak Scenario 1'i g√∂ster
        document.getElementById('scenario1').style.display = 'block';
        document.getElementById('tab-btn-1').classList.add('active');

        // ƒ∞lk hesaplamayƒ± √ßalƒ±≈ütƒ±r
        calculate();
    });
</script>
</body>
</html>